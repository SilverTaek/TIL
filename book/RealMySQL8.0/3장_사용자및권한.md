# 03 사용자 및 권한

- 사용자의 아이디뿐 아니라 해당 사용자가 어느 IP에서 접속하고 있는지 확인
- 8.0부터 권한을 묶어서 관리하는 역할의 개념이 도입, 각 사용자의 권한으로 미리 준비된 권한 세트를 부여 가능

## 3.1 사용자 식별

- 사용자의 계정뿐 아니라 사용자의 접속 지점도 계정의 일부가 된다.

만약 사용자 계정에 다음과 같은 계정만 등록돼 있다면 다른 컴퓨터에서는 svc_id라는 아이디로 접속할 수 없다.

```
'svc_id'@'127.0.0.1'
```

만약 모든 외부 컴퓨터에서 접속이 가능한 사용자 계정을 생성하려면 다음과 같이 설정하면 된다.

```
'svc_id'@'%'
```

만약 다음과 같이 2개의 사용자 계정이 있을 때, 권한이나 계정 정보에 대해 MySQL은 범위가 가장 작은 것을 항상 먼저 선택한다.

```
'svc_id'@'127.0.0.1'
'svc_id'@'%'
```

## 3.2 사용자 계정 관리

### 3.2.1 시스템 계정과 일반 계정

- MySQL 8.0부터 계정은 SYSTEM_USER 권한을 가지고 있는지에 따라서 시스템 계정, 일반 계정으로 구분된다. 시스템 계정은 DBA를 위한 계정이며, 일반 계정은 개발자를 위한 계정 정도로 생각하면 된다.

* 시스템 계정 작업

  - 계정 관리
  - 다른 세션 또는 그 세션에서 실행 중인 쿼리 강제 종료
  - 스토어드 프로그램 생성 시 DEFINER를 타 사용자로 설정

* MySQL 서버에 내장된 계정

- 'mysql.sys'@'localhost': MySQL8.0부터 기본으로 내장된 sys 스키마의 객체들의 DEFINER로 사용되는 계정
- 'mysql.session'@'localhost': MySQL 플러그인이 서버로 접근할 때 사용되는 계정
- 'mysql.inforschema'@'localhost': information_schema에 정의된 뷰의 DEFINER로 사용되는 계정

위 3개의 계정은 처음부터 잠겨있는 상태이므로 보안을 걱정하지 않아도 된다.

### 3.2.2 계정 생성

- 8.0부터 계정의 생성은 CREATE USER 명령어로, 권한 부여는 GRANT 명령어로 구분해서 실행

* 계정 생성 옵션

  - 계정의 인증 방식과 비밀번호
  - 비밀번호 관련 옵션
  - 기본 역할
  - SSL 옵션
  - 계정 잠금 여부

* IDENTIFIED WITH

  - 사용자의 인증 방식과 비밀번호를 설정한다.
  - 반드시 인증 방식을 명시해야 한다.

    - `Native Plugggable Authentication`: 단순히 비밀번호에 대한 해시(sha-1) 값을 저장해두고, 클라이언트가 보낸 값과 해시값이 일치하는지 비교하는 인증 방식
    - `Caching SHA-2 Pluggable Authentication`: 암호화 해시값 생성을 위해 SHA-2알고리즘 사용, 해시값을 계산해서 메모리에 캐시, SSL/TLS or RSA 키페어 사용, SSL 옵션 활성화
    - `PAM Pluggable Authentication`: 유닉스나 리눅스 패스워드 또는 LDAP같은 외부 인증을 사용할 수 있게 해주는 인증 방식
    - `LDAP Pluggable Authentication`: LDAP을 이용한 외부 인증을 사용할 수 있게 해주는 인증 방식

      5.7까지는 `Native Authentication` 이 기본 인증 방식에서 8.0부터 `Caching SHA-2 Authentication`으로 기본 인증 변경

* REQUIRE
  - MySQL 서버에 접속할 때 암호화 된 SSL/TLS 채널을 사용할지 여부를 결정
  - 만약 별도로 설정하지 않으면 비암호화 채널로 연결
  - `Caching SHA-2 Authentication` 인증 방식을 사용하면 암호화된 채널만으로 MySQL서버에 접속 가능
* PASSWORD EXPIRE
  - 비밀번호의 유효 기간을 설정하는 옵션
  - 기본값은 `default_password_lifetime` 변수에 저장된 기간으로 설정
* PASSWORD HISTORY
  - 한 번 사용했던 비밀번호를 재사용하지 못하게 설정하는 옵션
* PASSWORD REUSE INTERVAL
  - 한 번 사용했던 비밀번호의 재사용 금지 기간을 설정하는 옵션
  - 기본값은 `password_reuse_interval` 변수에 저장된 기간으로 설정
* PASSWORD REQUIRE
  - 비밀번호가 만료되어 새로운 비밀번호로 변경할 때 현재 비밀번호를 필요로 할지 말지를 결정하는 옵션
* ACCOUNT LOCK / UNLOCK
  - 계정 생성 시 또는 ALTER USER 명령을 사용해 계정 정보를 변경할 때 계정을 사용하지 못하게 잠글지 여부를 결정

## 3.3 비밀번호 관리

### 3.3.1 고수준 비밀번호

- MySQL 서버에서 비밀번호의 유효성 체크 규칙을 적용하려면 `validate_password` 컴포넌트를 이용하면 된다.

### 3.3.2 이중 비밀번호

- 일반적으로 많은 응용 프로그램 서버들이 공용으로 데이터베이스 서버를 사용하기 때문에 데이터베이스 서버의 계정 정보는 응용 프로그램 서버로부터 공용으로 사용되는 경우가 많다.
- 기존에는 서비스를 모두 멈추지 않고 비밀번호를 변경하는 것은 불가능했기 때문에 8.0부터는 계정의 비밀번호로 2개의 값을 동시에 사용할 수 있는 기능을 추가했다.
- 여기서의 이중 비밀번호는 하나의 계정에 대해 2개의 비밀번호 중 하나만 일치하면 로그인이 통과되는 것을 의미한다.

## 3.4 권한

- 8.0부터는 5.7버전의 권한에 다음의 동적 권한이 더 추가됐다.
- MySQL 서버의 컴포넌트나 플러그인이 설치되면 그때 등록되는 권한을 동적 권한이라 한다.
- 8.0부터는 존재하지 않는 사용자에 대해 GRANT 명령이 실행되면 에러가 발생하므로 반드시 사용자를 먼저 생성하고 GRANT 명령으로 권한을 부여해야 한다.

### 글로벌 권한

```
mysql> GRANT SUPER ON *.* TO 'user'@'localhost';
```

### DB 권한

```
mysql> GRANT EVENT ON *.* TO 'user'@'localhost';
mysql> GRANT EVENT ON employees.* TO 'user'@'localhost';
```

## 3.5 역할(Role)

- MySQL 8.0부터 권한을 묶어서 역할(Role)을 사용할 수 있게 됐다.
